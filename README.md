# Embedded TypeScript

<blockquote>Type safe embedded TypeScript templates</blockquote>

<br />

<a href="https://www.npmjs.com/package/embedded-typescript">
  <img src="https://img.shields.io/npm/v/embedded-typescript.svg">
</a>
<a href="https://github.com/tatethurston/embedded-typescript/blob/master/LICENSE">
  <img src="https://img.shields.io/npm/l/embedded-typescript.svg">
</a>
<a href="https://bundlephobia.com/result?p=embedded-typescript">
  <img src="https://img.shields.io/bundlephobia/minzip/embedded-typescript">
</a>
<a href="https://www.npmjs.com/package/embedded-typescript">
  <img src="https://img.shields.io/npm/dy/embedded-typescript.svg">
</a>
<a href="https://github.com/tatethurston/embedded-typescript/actions/workflows/ci.yml">
  <img src="https://github.com/tatethurston/embedded-typescript/actions/workflows/ci.yml/badge.svg">
</a>

## What is this? üßê

A type safe templating system for TypeScript. Templates are compiled to TypeScript files that are then imported for type safe string generation.

This templating system draws inspiration from ERB, [EJS](https://ejs.co/), [handlebars](https://handlebarsjs.com/) and [mustache](https://github.com/janl/mustache.js). This project embraces the "just JavaScript" spirit of ejs and adds some of the helpful white space semantics of mustache.

Checkout the [examples](#examples-) or [play with embedded-typescript in your browser](https://codesandbox.io/s/ets-playground-9mzk8).

## Installation & Usage üì¶

1. Add this package to your project:
   - `yarn add embedded-typescript`

## Motivation

`Hello undefined!`

When using a typed language, I want my templates to be type checked. For most cases, [template literals](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals) work well. If I'm writing XML, [JSX](https://www.typescriptlang.org/docs/handbook/jsx.html) works well. When I have complicated non-XML templates, template literals become difficult to maintain. I can use ejs/hbs/mustache/etc, but then I lose the type safety I had with template literals. Sometimes I want the expressiveness of a templating language without losing type safety. For those cases, I wrote `embedded-typescript`.

## Notable deviations from prior art

Top level `<% CODE %>` blocks must be defined around any text. This enables complete control over the namespace: you explicitly specify exports and their type signature . This also enables using `import` to pull in any helpers, utilities or partials.

This templating system does _not_ perform any HTML escaping. You can `import` any self authored or 3rd party HTML escaping utilities in your template, and call that directly on any untrusted input.

## Syntax

`<%= EXPRESSION %>` ‚Äî Inserts the value of an expression.

`<% CODE %>` ‚Äî Executes code, but does not insert a value. Trims the preceding indentation and the following line break if placed on it's own line.

## Examples üöÄ

1. Write a template file: `my-template.ets`:

```
<% type User = { name: string; } %>

<% export function render(users: User[]): string { %>
  <% users.forEach(function(user) { %>
Name: <%= user.name %>
  <% }) %>
<% } %>
```

2. Run the compiler: `yarn ets`. This will compile any files with the `.ets` extension. `my-template.ets.ts` will be generated.

3. Import from the generated `.ets.ts` file:

```
import { render } from "./template-1.ets";

// will output:
// Name: Alice
// Name: Bob
console.log(render([
  { name: "Alice" },
  { name: "Bob" },
]))
```

Note that the arguments to your template function are typechecked. There isn't anything special about the `render` export, in our template file this could have been named anything: `printUserNames`.

For more examples, take a look at the [example directory](https://github.com/tatethurston/embedded-typescript/blob/main/example). The `*.ets.ts` files are generated by the compiler from the `*.ets` template files. The corresponding `*${NAME}.test.ts` shows example usage and output.

## Understanding Error Messages

The compiler will output errors when it encounters invalid syntax:

```
error: Unexpected closing tag '%>'
   --> ./template-1.ets:2:54
    |
2   | <% export function render(users: User[]): string { %>%>
    |                                                      ^
    |                                                      |
...
```

The first line is a description of the error that was encountered.

The second line is location of the error, in `path:line:column` notation.

The next 5 lines provide visual context for the error.

## Highlights

üéÅ Zero run time dependencies

## Contributing üë´

PR's and issues welcomed! For more guidance check out [CONTRIBUTING.md](https://github.com/tatethurston/embedded-typescript/blob/master/CONTRIBUTING.md)

## Licensing üìÉ

See the project's [MIT License](https://github.com/tatethurston/embedded-typescript/blob/master/LICENSE).
